# دليل النشر المجاني لنظام PEMS

## 1. إعداد DigitalOcean Spaces (تخزين الملفات)

### إنشاء Spaces:
1. سجل دخول إلى DigitalOcean
2. اذهب إلى Spaces Object Storage
3. أنشئ Space جديد:
   - الاسم: `pems-files`
   - المنطقة: `NYC3`
   - الوصول: `Public`

### الحصول على مفاتيح API:
1. اذهب إلى API → Spaces Keys
2. أنشئ مفتاح جديد
3. احفظ Access Key و Secret Key

## 2. خيارات النشر المجاني

### أ) Railway (الأفضل - مجاني 5$ شهرياً)
```bash
# 1. إنشاء حساب على railway.app
# 2. ربط GitHub repository
# 3. إضافة متغيرات البيئة:

APP_NAME="نظام إدارة مصروفات الإنتاج الفني"
APP_ENV=production
APP_DEBUG=false
APP_URL=https://your-app.railway.app

# Database (Railway PostgreSQL)
DATABASE_URL=postgresql://username:password@host:port/database

# DigitalOcean Spaces
DO_SPACES_KEY=your-access-key
DO_SPACES_SECRET=your-secret-key
DO_SPACES_REGION=nyc3
DO_SPACES_BUCKET=pems-files
DO_SPACES_ENDPOINT=https://nyc3.digitaloceanspaces.com
DO_SPACES_URL=https://pems-files.nyc3.digitaloceanspaces.com

FILESYSTEM_DISK=digitalocean
SESSION_DRIVER=database
CACHE_STORE=database
```

### ب) Render (مجاني مع قيود)
```bash
# 1. إنشاء حساب على render.com
# 2. ربط GitHub repository
# 3. استخدام render.yaml الموجود
# 4. إضافة نفس متغيرات البيئة
```

### ج) Vercel (للواجهة الأمامية فقط)
```bash
# 1. إنشاء حساب على vercel.com
# 2. ربط GitHub repository
# 3. استخدام vercel.json الموجود
# 4. إضافة متغيرات البيئة في Dashboard
```

## 3. إعداد قاعدة البيانات المجانية

### أ) Supabase (الأفضل)
```bash
# 1. إنشاء حساب على supabase.com
# 2. إنشاء مشروع جديد
# 3. الحصول على بيانات الاتصال:

DB_CONNECTION=pgsql
DB_HOST=your-project.supabase.co
DB_PORT=5432
DB_DATABASE=postgres
DB_USERNAME=postgres
DB_PASSWORD=your-password
```

### ب) Railway PostgreSQL
```bash
# يتم إنشاؤها تلقائياً مع Railway
DATABASE_URL=postgresql://username:password@host:port/database
```

## 4. خطوات النشر

### 1. تحضير المشروع:
```bash
# تثبيت التبعيات
composer install --no-dev --optimize-autoloader
npm install && npm run build

# إنشاء مفتاح التطبيق
php artisan key:generate

# تشغيل الهجرات
php artisan migrate --force
php artisan db:seed --force
```

### 2. رفع على GitHub:
```bash
git init
git add .
git commit -m "Initial commit"
git branch -M main
git remote add origin https://github.com/username/pems.git
git push -u origin main
```

### 3. ربط مع منصة النشر:
- Railway: ربط Repository → Deploy
- Render: ربط Repository → إضافة متغيرات البيئة
- Vercel: ربط Repository → إضافة متغيرات البيئة

## 5. إعداد النطاق المخصص (اختياري)

### ربط نطاق مجاني:
1. احصل على نطاق مجاني من Freenom أو استخدم subdomain
2. أضف CNAME record يشير إلى:
   - Railway: `your-app.railway.app`
   - Render: `your-app.onrender.com`
   - Vercel: `your-app.vercel.app`

## 6. متغيرات البيئة المطلوبة

```env
# أساسي
APP_NAME="نظام إدارة مصروفات الإنتاج الفني"
APP_ENV=production
APP_KEY=base64:your-generated-key
APP_DEBUG=false
APP_URL=https://your-domain.com

# قاعدة البيانات
DB_CONNECTION=pgsql
DB_HOST=your-host
DB_PORT=5432
DB_DATABASE=your-database
DB_USERNAME=your-username
DB_PASSWORD=your-password

# DigitalOcean Spaces
DO_SPACES_KEY=your-access-key
DO_SPACES_SECRET=your-secret-key
DO_SPACES_REGION=nyc3
DO_SPACES_BUCKET=pems-files
DO_SPACES_ENDPOINT=https://nyc3.digitaloceanspaces.com
DO_SPACES_URL=https://pems-files.nyc3.digitaloceanspaces.com

# إعدادات النظام
FILESYSTEM_DISK=digitalocean
SESSION_DRIVER=database
CACHE_STORE=database
QUEUE_CONNECTION=database
LOG_LEVEL=error

# البريد الإلكتروني (اختياري)
MAIL_MAILER=smtp
MAIL_HOST=smtp.gmail.com
MAIL_PORT=587
MAIL_USERNAME=your-email@gmail.com
MAIL_PASSWORD=your-app-password
MAIL_ENCRYPTION=tls
```

## 7. اختبار النشر

بعد النشر، تأكد من:
- [ ] تحميل الصفحة الرئيسية
- [ ] تسجيل الدخول بحساب المدير
- [ ] رفع ملف واختبار التخزين
- [ ] إنشاء مشروع جديد
- [ ] إضافة مصروف جديد

## 8. حساب المدير الافتراضي

```
البريد الإلكتروني: admin@pems.com
كلمة المرور: admin123
```

## 9. الصيانة والتحديث

```bash
# لتحديث التطبيق:
git add .
git commit -m "Update"
git push origin main

# سيتم النشر تلقائياً
```

## 10. استكشاف الأخطاء

### مشاكل شائعة:
1. **خطأ 500**: تحقق من LOG_LEVEL=debug مؤقتاً
2. **مشاكل قاعدة البيانات**: تأكد من صحة بيانات الاتصال
3. **مشاكل الملفات**: تأكد من إعدادات DigitalOcean Spaces
4. **مشاكل الذاكرة**: استخدم `composer install --no-dev`

### روابط مفيدة:
- Railway: https://railway.app
- Render: https://render.com  
- Vercel: https://vercel.com
- Supabase: https://supabase.com
- DigitalOcean: https://digitalocean.com